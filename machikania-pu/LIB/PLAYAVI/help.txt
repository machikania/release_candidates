＜クラス名およびバージョン＞
PLAYAVI
ver 0.3.1

＜ファイル名＞
PLAYAVI.BAS

＜ライセンス＞
BASファイルは、パブリックドメイン。


＜概要＞
MachiKania type PUで、動画を再生するためのクラス。主に、Raspberry Pi Pico 2などのRP2350搭載のボードで使用する。

参考：「MachiKania type PUで動画再生」
https://www.rad51.net/blog/mycom/index.php?itemid=991


＜コンストラクター＞
第一引数
	動画ファイル(AVIファイル)のファイル名。AVIファイルのフォーマットは、下記を参照。


＜メソッド＞
SETWAVE(x$)
	動画再生時に音声を出力したいときに呼び出す。x$は、WAVファイル。WAVファイルのフォーマットは、下記を参照。

PLAY()
	動画を一コマ進める。

MOVEAVIPOINTER(x)
	動画を指定のコマ数だけ進める。xにコマ数を指定。負の数を指定すれば、巻き戻しも可能。

MOVEWAVPOINTER(x)
	音声を指定のビット数だけ進める。xにビット数を指定。負の数を指定すれば、巻き戻しも可能。音声使用時は、一コマ当たり1055ビットであることに注意。


＜パブリックフィールド＞
なし。


＜MachiKaniaの実行速度について＞
ここで用いるMachiKania type PUは、CPUを315 MHzで実行することを前提にして設計されている。また、ファイルシステムのクロック周波数も、40 MHz程度まで上げて使用することが求められる。この目的のため、MachiKania type PUは、バージョンが1.5.3以上の物を使用すること。

＜動画データーについて＞
動画データーには、圧縮なしのAVIファイルを用いる。以下の要件に当てはまる必要がある。

・幅は、336ピクセル以下
・高さは、216ピクセル以下
・上下反転
・画像データーは圧縮なし
・画像は256色パレット
・音声データーを含まない

また、大きな縦横サイズの動画ではRP2350を315 MHzで使った場合のフレームレートは、15 fps（正確には、15.0467 fps; 157500000/11/908/262/4）が最速である。縦横サイズを230x148ピクセルまで小さくすれば、30 fps（正確には、30.0934 fps; 157500000/11/908/262/2）での動画再生が可能になる。

参考：「MachiKania type PUで動画再生、その２」
https://www.rad51.net/blog/mycom/index.php?itemid=991


＜音声データーについて＞
音声付きの画像を再生する場合は、別途WAVファイルを準備する。以下の要件に当てはまる必要がある。

・圧縮なし
・8ビットPCM
・モノラル
・サンプリング周波数 15825 Hz（30 fpsの動画を編集して15 fpsで再生して用いる場合）

ただし、元動画が29.97 fpsの場合などは、サンプリング周波数の微調整が必要。この場合は 15809 Hzを用いることになる(15825*29.97/30)。また、動画を長時間再生する場合は 15809 Hzでも音声と画像が少しずつずれてくるので、適宜MOVEWAVPOINTERメソッドで修正する必要がある。

参考：「MachiKania type PUで動画再生、その３」
https://www.rad51.net/blog/mycom/index.php?itemid=992


＜使用例＞
15 fpsの動画(*.avi)を再生する場合。音声が要らないときは、SETWAVEメソッドを省略する。

useclass PLAYAVI
cls
system 51,15
system 50,315000000
system 57,40000000
a=new(PLAYAVI,"crick15.avi")
a.SETWAVE("crick15.wav")
do
  wait 1
loop while http://a.play()

